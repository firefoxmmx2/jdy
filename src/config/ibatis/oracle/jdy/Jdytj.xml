<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"  "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<typeAlias alias="Jdytjxx" type="com.aisino2.jdy.domain.Jdytjxx"/>

	<cacheModel id="oneDayCategory" type="LRU">
		<flushInterval hours="24"/>
	</cacheModel>
<!-- 	寄递对象统计结果 -->
	<resultMap class="Jdytjxx" id="jdxxtj_rm">
		<result property="xm" column="xm"/>
		<result property="zjhm" column="zjhm"/>
		<result property="lxdh" column="lxdh"/>
		<result property="xxdz" column="xxdz"/>
		<result property="cs" column="cs"/>
	</resultMap>
	
<!-- 	企业对象统计结果 -->

	<resultMap class="Jdytjxx" id="qydxtj_rm">
		<result property="qyid" column="qyid"/>
		<result property="qymc" column="qymc"/>
		<result property="cs" column="cs"/>
		<result property="xxdz" column="jydz"/>
		<result property="lxdh" column="lxdh"/>
		<result property="gxdwmc" column="gxdwmc"/>
	</resultMap>
	
	<sql id="JdytjxxWhere">
		<isNotEmpty prepend="and" property="pjsjf">
			p.pjsj >= #pjsjf#
		</isNotEmpty>
		
		<isNotEmpty prepend="and" property="pjsjt">
			p.pjsj &lt;= #pjsjt#
		</isNotEmpty>
		
		<isNotEmpty prepend="and" property="ljsjf">
			l.ljsj >= #ljsjf#
		</isNotEmpty>
		
		<isNotEmpty prepend="and" property="ljsjt">
			l.ljsj &lt;= #ljsjt#
		</isNotEmpty>
		
		<isNotEmpty prepend="and" property="gxdwbm">
			q.gxdwbm like '$gxdwbm$%'
		</isNotEmpty>
		
		
	</sql>
	
	<sql id="JdytjxxOutterWhere">
		<isNotEmpty prepend="and" property="show_number">
			rownum &lt;= #show_number#
		</isNotEmpty>
	</sql>
	
<!-- 	个人寄件量统计 -->
	<select id="Jdytjxx.jjltj" parameterClass="map" resultMap="jdxxtj_rm">
		select * from (
		  select  jjr.xm,count(jjr.id) cs,jjr.xxdz,jjr.lxdh,jjr.zjhm 
		  from t_ljjbxx l , t_qyjbxx q , t_rdrjbxx jjr
		  where l.jjr_id=jjr.id and l.qybm = q.qybm
		  <dynamic prepend="and">
		  	<include refid="JdytjxxWhere"/>
		  </dynamic> 
		  group by jjr.xm, jjr.xxdz, jjr.lxdh, jjr.zjhm 
		  order by cs desc) z 
		<dynamic prepend="where">
			<include refid="JdytjxxOutterWhere"/>
		</dynamic> 
		 
	</select>
<!-- 	个人收件量统计 -->
	<select id="Jdytjxx.sjltj" parameterClass="map" resultMap="jdxxtj_rm">
		select * from (
		  select  sjr.xm,count(sjr.id) cs,sjr.xxdz,sjr.lxdh,sjr.zjhm 
		  from t_ljjbxx l , t_qyjbxx q , t_rdrjbxx sjr
		  where l.sjr_id=sjr.id and l.qybm = q.qybm 
		  <dynamic prepend="and">
		  	<include refid="JdytjxxWhere"/>
		  </dynamic> 
		  group by sjr.xm, sjr.xxdz, sjr.lxdh, sjr.zjhm 
		  order by cs desc
		) z
		<dynamic prepend="where">
			<include refid="JdytjxxOutterWhere"/>
		</dynamic> 
	</select>
	
<!-- 	企业揽件量统计 -->
	<select id="Jdytjxx.qyljltj" parameterClass="map" resultMap="qydxtj_rm">
		select * from (
		  select  q.qyid, q.qymc,count(1) cs,q.jydz,q.lxdh,q.gxdwmc 
		  from t_ljjbxx l , t_qyjbxx q
		  where l.qybm = q.qybm
		  <dynamic prepend="and">
		  	<include refid="JdytjxxWhere"/>
		  </dynamic> 
		  group by q.qyid, q.qymc, q.jydz, q.lxdh, q.gxdwmc 
		  order by cs desc
		) z
		<dynamic prepend="where">
			<include refid="JdytjxxOutterWhere"/>
		</dynamic> 
	</select>
	
<!-- 	企业派件量统计 -->
	<select id="Jdytjxx.qypjltj" parameterClass="map" resultMap="qydxtj_rm">
		select * from (
		  select  q.qyid, q.qymc,count(1) cs,q.jydz,q.lxdh,q.gxdwmc 
		  from t_ljjbxx l , t_qyjbxx q, t_pjjbxx p
		  where l.qybm = q.qybm and p.ljjbxx_id = l.djxh
		  <dynamic prepend="and">
		  	<include refid="JdytjxxWhere"/>
		  </dynamic>  
		  group by q.qyid, q.qymc, q.jydz, q.lxdh, q.gxdwmc 
		  order by cs desc
		) z
		<dynamic prepend="where">
			<include refid="JdytjxxOutterWhere"/>
		</dynamic> 
	</select>
</sqlMap>