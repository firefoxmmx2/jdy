<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"  "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap>
	<typeAlias alias="ljjbxx" type="com.aisino2.jdy.domain.Ljjbxx"/>
	<cacheModel id="oneDayCategory" type="LRU">
		<flushInterval hours="24"/>
	</cacheModel>
	
<!-- 	公共结果集 -->
	<resultMap class="ljjbxx" id="ljjbxx_base_rm">
		<result property="djxh" column="djxh" />
		<result property="ljsj" column="ljsj" />
		<result property="ljtbsj" column="ljtbsj" />
		<result property="wldh" column="wldh"/>
	</resultMap>
<!-- 	揽件信息基本结果，不关联详情 -->
	<resultMap class="ljjbxx" id="ljjbxx_rm" extends="ljjbxx_base_rm">
		<result property="jjr.id" column="jjr_id" />
		<result property="sjr.id" column="sjr_id" />
		<result property="ljr.cyrybh" column="ljrbh" />
		<result property="ljtbr.cyrybh" column="ljtbrbh" />
	</resultMap>
<!-- 	揽件信息结果 ，关联详情 -->
	<resultMap class="ljjbxx" id="ljjbxx_mx_rm" extends="ljjbxx_base_rm">
		<result property="jjr" column="jjr_id" select="Rdrjbxx.getById"/>
		<result property="sjr" column="sjr_id" select="Rdrjbxx.getById"/>
		<result property="ljr" column="ljrbh" select="getQyryxxByCyrybh"/>
		<result property="ljtbr" column="ljtbrbh" select="getQyryxxByCyrybh"/>
	</resultMap>
<!--  揽件信息列表	收件人结果 -->
	<resultMap class="Rdrjbxx" id="ljjbxx_list_sjr_rm">
		<result property="id" column="sjr_id"/>
		<result property="xm" column="sjr_xm"/>
		<result property="zjhm" column="sjr_zjhm"/>
<!-- 		<result property="zjlx" column="sjr_zjlx"/> -->
<!-- 		<result property="ssx" column="sjr_ssx"/> -->
<!-- 		<result property="xxdx" column="sjr_xxdz"/> -->
<!-- 		<result property="lxdh" column="sjr_lxdh"/> -->
<!-- 		<result property="gddh" column="sjr_gddh"/> -->
	</resultMap>
<!-- 	寄件人结果 -->
	<resultMap class="Rdrjbxx" id="ljjbxx_list_jjr_rm">
			<result property="id" column="jjr_id"/>
			<result property="xm" column="jjr_xm"/>
			<result property="zjhm" column="jjr_zjhm"/>
	</resultMap>
<!-- 	揽件信息列表查询结果 -->
	<resultMap class="ljjbxx" id="ljjbxx_list_rm" extends="ljjbxx_base_rm">
		<result property="jjr" resultMap="ljjbxx_list_jjr_rm"/>
		<result property="sjr" resultMap="ljjbxx_list_sjr_rm"/>
		<result property="ljr.xm" column="ljr_xm"/>
		<result property="ljr.cyrybh" column="ljr_cyrybh"/>
		
<!-- 		查询列表里面没有所需要这个字段，暂时不给出 -->
<!-- 		<result property="ljrtbr" resultMap=""/> --> 
	</resultMap>
	
	
	<sql id="ljjbxxWhere" >
		<isNotEmpty prepend="and" property="djxh"> 
			ljjbxx.djxh=#djxh#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="wldh">
			ljjbxx.wldh=#wldh#
		</isNotEmpty>
	</sql>
	<sql id="ljjbxxPageWhere">
		<include refid="ljjbxxWhere"/>
		
		<isNotEmpty prepend="and" property="ljsjf">
			ljjbxx.ljsj >= #ljsjf#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="ljsjt">
			ljjbxx.ljsj &lt;= #ljsjt#
		</isNotEmpty>
		
			
		<isNotEmpty prepend="" property="jjr" >
			<isNotEmpty prepend="and" property="jjr.id">
				ljjbxx.jjr_id=#jjr.id#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="jjr.xm">
				jjr.xm like '%$jjr.xm$%'
			</isNotEmpty>
			<isNotEmpty prepend="and" property="jjr.zjhm"> 
				jjr.zjhm=#jjr.zjhm#
			</isNotEmpty>
			<isNotEmpty prepend="and" property="jjr.zjlx">
				jjr.zjlx=#jjr.zjlx#
			</isNotEmpty>
		</isNotEmpty>
		
		<isNotEmpty prepend="" property="ljr">
			<isNotEmpty prepend="and" property="ljr.cyrybh">
				ljjbxx.ljrbh=#ljr.cyrybh#
			</isNotEmpty>
		</isNotEmpty>
	</sql>
<!-- 	通过从业人员编号得到从业人员信息 -->
	<select id="getQyryxxByCyrybh" resultMap="qyryxxResult" parameterClass="String" > 
		select a.xzdxzqh xzdxzqh,a.xzdxzqhdm xzdxzqhdm,a.qyid qyid,a.ryid ryid,a.hylbdm hylbdm,a.hylb hylb,a.cyrybh cyrybh,a.cyrylbdm cyrylbdm,a.cyrylbmc cyrylbmc,a.xm xm,a.qm qm,a.bm bm,a.xmpy xmpy,a.gjdm gjdm,a.gj gj,a.mzdm mzdm,a.minzu minzu,a.xbdm xbdm,a.xb xb,a.csrq csrq,a.hyzkdm hyzkdm,a.hyzk hyzk,a.shengao shengao,a.tizh tizh,a.hjdxzqh hjdxzqh,a.hjdxzqhdm hjdxzqhdm,a.hjdxz hjdxz,a.cyzjdm cyzjdm,a.cyzj cyzj,a.zjhm zjhm,a.zzzhm zzzhm,a.zzdz zzdz,a.gwbh gwbh,a.gwmc gwmc,a.gwzrms gwzrms,a.shouji shouji,a.lxdh lxdh,a.jjlxr jjlxr,a.jjlxrdh jjlxrdh,a.gzdm gzdm,a.gz gz,a.zhiwu zhiwu,a.rzrq rzrq,a.cyryztdm cyryztdm,a.cyryzt cyryzt,a.zxr zxr,a.zxbz zxbz,a.zxsj zxsj,a.lrsj lrsj,a.lrr lrr,a.lrdwbm lrdwbm,a.lrdwmc lrdwmc,a.hcdw hcdw,a.hcr hcr,a.hcsj hcsj,a.zxyy zxyy,a.zkzt zkzt,a.bcsj bcsj,a.dcbs dcbs,a.bz bz,a.scbz scbz,a.biduiflag biduiflag,a.zpwtgyy zpwtgyy,a.zt zt,a.yjbz yjbz,a.yjsj yjsj
		,b.qymc,b.qybm ,a.lzrq , a.xxdm,a.xx ,a.whcd,a.whcddm  , a.cylbdm , a.cylb,a.djrq,a.hjlbdm,a.hjlbmc,a.zzmmdm,a.zzmmmc
		from t_qyryxx a ,t_qyjbxx b
		where a.qyid=b.qyid
		and a.cyrybh=#value#
	</select>
	
<!-- 	插入揽件信息 -->
	<insert id="ljjbxx.insert" parameterClass="ljjbxx">
		insert into t_ljjbxx (
		<dynamic prepend=" ">
			<isNotNull prepend="," property="djxh">
				djxh
			</isNotNull>
			<isNotNull prepend="," property="ljsj">
				ljsj
			</isNotNull>
			<isNotNull prepend="," property="ljtbsj">
				ljtbsj
			</isNotNull>
			<isNotNull prepend="," property="wldh">
				wldh
			</isNotNull>
			<isNotNull prepend="," property="jjr.id">
				jjr_id
			</isNotNull>
			<isNotNull prepend="," property="sjr.id">
				sjr_id
			</isNotNull>
			<isNotNull prepend="," property="ljr.cyrybh">
				ljrbh
			</isNotNull>
			<isNotNull prepend="," property="ljtbr.cyrybh">
				ljtbrbh
			</isNotNull>
		</dynamic>
		)
		values (
		<dynamic prepend=" ">
			<isNotNull prepend="," property="djxh">
				#djxh#
			</isNotNull>
			<isNotNull prepend="," property="ljsj">
				#ljsj#
			</isNotNull>
			<isNotNull prepend="," property="ljtbsj">
				#ljtbsj#
			</isNotNull>
			<isNotNull prepend="," property="wldh">
				#wldh#
			</isNotNull>
			<isNotNull prepend="," property="jjr.id">
				#jjr.id#
			</isNotNull>
			<isNotNull prepend="," property="sjr.id">
				#sjr.id#
			</isNotNull>
			<isNotNull prepend="," property="ljr.cyrybh">
				#ljr.cyrybh#
			</isNotNull>
			<isNotNull prepend="," property="ljtbr.cyrybh">
				#ljtbr.cyrybh#
			</isNotNull>
		</dynamic>
		)
	</insert>
	
	<delete id="ljjbxx.delete" parameterClass="ljjbxx">
		delete from t_ljjbxx ljjbxx
		where
		<dynamic prepend=" ">
			<include refid="ljjbxxWhere"/>
		</dynamic>
	</delete>
	
	<update id="ljjbxx.update" parameterClass="ljjbxx">
		update from t_ljjbxx ljjbxx
		set djxh = djxh
		<dynamic prepend=",">
			<isNotNull prepend="," property="djxh">
				djxh=#djxh#
			</isNotNull>
			<isNotNull prepend="," property="ljsj">
				ljsj=#ljsj#
			</isNotNull>
			<isNotNull prepend="," property="ljtbsj">
				ljtbsj=#ljtbsj#
			</isNotNull>
			<isNotNull prepend="," property="wldh">
				wldh=#wldh#
			</isNotNull>
			<isNotNull prepend="," property="jjr.id">
				jjr_id=#jjr.id#
			</isNotNull>
			<isNotNull prepend="," property="sjr.id">
				sjr_id=#sjr.id#
			</isNotNull>
			<isNotNull prepend="," property="ljr.cyrybh">
				ljrbh=#ljr.cyrybh#
			</isNotNull>
			<isNotNull prepend="," property="ljtbr.cyrybh">
				ljtbrbh=#ljtbr.cyrybh#
			</isNotNull>
		</dynamic>
		where
		<dynamic prepend=" ">
			<include refid="ljjbxxWhere"/>
		</dynamic>
	</update>
	
<!-- 	获取单一揽件信息 -->
	<select id="ljjbxx.get" parameterClass="ljjbxx" resultMap="ljjbxx_mx_rm">
		select * from t_ljjbxx ljjbxx
		where
		<dynamic prepend=" ">
			<include refid="ljjbxxWhere"/>
		</dynamic>
	</select>
<!-- 	获取揽件信息列表 -->
	<select id="ljjbxx.getList" parameterClass="ljjbxx" resultMap="ljjbxx_list_rm">
		select ljjbxx.djxh,ljjbxx.ljsj,ljjbxx.ljtbsj
		,jjr.xm jjr_xm,jjr.zjlx jjr_zjlx,jjr.zjhm jjr_zjhm
		,sjr.xm sjr_xm,sjr.zjlx jsr_zjlx,sjr.zjhm sjr_zjhm
		,ljr.xm ljr_xm, ljr.cyrybh ljr_cyrybh
		from t_ljjbxx ljjbxx,t_rdrjbxx jjr,t_rdrjbxx sjr,t_qyryxx ljr
		where ljjbxx.jjr_id=jjr.id and ljjbxx.sjr_id=sjr.id and ljr.cyrybh=ljjbxx.ljrbh
		<dynamic prepend=" ">
			<include refid="ljjbxxPageWhere"/>
		</dynamic>
	</select>
<!-- 	获取揽件信息列表分页记录数  -->
	<select id="ljjbxx.getListPageCount" parameterClass="map" resultClass="Integer">
		select count(1) from t_ljjbxx ljjbxx,t_rdrjbxx jjr,t_rdrjbxx sjr,t_qyryxx ljr
		where ljjbxx.jjr_id=jjr.id and ljjbxx.sjr_id=sjr.id and ljr.cyrybh=ljjbxx.ljrbh
		<dynamic prepend=" ">
			<include refid="ljjbxxPageWhere"/>
		</dynamic>
	</select>
<!-- 	获取揽件信息列表分页 -->
	<select id="ljjbxx.getListPage" parameterClass="map" resultMap="ljjbxx_list_rm">
		select x.* from (
		select rownum rowno,z.* from 
		(	select ljjbxx.djxh,ljjbxx.ljsj,ljjbxx.ljtbsj
			,jjr.xm jjr_xm,jjr.zjlx jjr_zjlx,jjr.zjhm jjr_zjhm
			,sjr.xm sjr_xm,sjr.zjlx jsr_zjlx,sjr.zjhm sjr_zjhm
			,ljr.xm ljr_xm, ljr.cyrybh ljr_cyrybh
			from t_ljjbxx ljjbxx,t_rdrjbxx jjr,t_rdrjbxx sjr,t_qyryxx ljr 
		where ljjbxx.jjr_id=jjr.id and ljjbxx.sjr_id=sjr.id and ljr.cyrybh=ljjbxx.ljrbh
		<dynamic prepend=" ">
			<include refid="ljjbxxPageWhere" />
		</dynamic>
		order by $pageSort$)  z) x where rowno &gt;$beginRow$ and rowno &lt;= $endRow$ 
	</select>
	
	<select id="ljjbxx.getByDjxh" parameterClass="String" resultMap="ljjbxx_mx_rm">
		select * from t_ljjbxx ljjbxx where ljjbxx.djxh=#value#
	</select>
</sqlMap>
